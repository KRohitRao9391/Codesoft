<!doctype html>
<html>
<head><meta charset="utf-8"><title>Login / Register</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="style.css"></head>
<body>
  <header class="top"><div class="wrap"><h1>Mini Shop</h1><nav><a href="index.html">Home</a><a href="cart.html">Cart</a></nav></div></header>
  <main class="container">
    <h2>Login</h2>
    <form id="loginForm">
      <label>Email<input name="email" required></label>
      <label>Password<input type="password" name="password" required></label>
      <button>Login</button>
    </form>
    <hr>
    <h2>Register</h2>
    <form id="regForm">
      <label>Name<input name="name"></label>
      <label>Email<input name="email" required></label>
      <label>Password<input type="password" name="password" required></label>
      <button>Register</button>
    </form>
  </main>
<script>
document.getElementById('loginForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = { email: fd.get('email'), password: fd.get('password') };
  const res = await fetch('/api/auth/login',{ method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(payload) });
  if(res.ok){ const data = await res.json(); localStorage.setItem('token', data.token); alert('Logged in'); window.location='index.html'; }
  else { const err = await res.json(); alert('Error: '+(err.error || err.msg || 'failed')); }
});
document.getElementById('regForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = { name: fd.get('name'), email: fd.get('email'), password: fd.get('password') };
  const res = await fetch('/api/auth/register',{ method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(payload) });
  if(res.ok){ const data = await res.json(); localStorage.setItem('token', data.token); alert('Registered and logged in'); window.location='index.html'; }
  else { const err = await res.json(); alert('Error: '+(err.error || 'failed')); }
});
</script>
</body>
</html>
